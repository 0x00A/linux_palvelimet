## Artikkelin tiivistys[^1][^2]
- Virtuaalipalvelimen vuokraus on edullista ja helppoa, suosittuja palveluntarjoajia on useita. mm. DigitalOcean, UpCloud, Linode.
- Virtuaalipalvelimen vuokraaminen tapahtuu yleens√§ palveluntarjoajan verkkosivujen kautta josta voi valita k√§ytt√∂j√§rjestelm√§n, palvelimen sijainnin ja konfiguroida rautaa.
- Palvelimella kannattaa ottaa k√§ytt√∂√∂n palomuuri (esim. ufw) ja muistaa sallia SSH liikenne ennen sen p√§√§lle kytkemist√§.
- Palvelimelle kannattaa luoda uusi k√§ytt√§j√§, jolla ei ole automaattisia root oikeuksia, jonka j√§lkeen root k√§ytt√§j√§ kannattaa lukita sek√§ est√§√§ SSH kirjautuminen root k√§ytt√§j√§n√§.
- Palvelimella kannattaa my√∂s p√§ivitt√§√§ sille asennetut paketit.

## Teht√§v√§t

### a) Oman virtuaalipalvelimen vuokraus
Valitsin palveluntarjoaksi UpCloudin, sill√§ siell√§ oli ilmainen 30-p√§iv√§n kokeilujakso (max. 500‚Ç¨).

Virtuaalipalvelimen vuokraus tapahtui UpCloudin verkkosivujen kautta, valitsin Developer planista:
- Sijainti: FI-HEL1
- 1 core, 2 GB RAM, 30 GB Storage (max. 8‚Ç¨/kk)
- OS: Debian 13

Kirjautumis tapana on tarjolla ainoastaan SSH avainten k√§ytt√∂, joten loin ensin SSH avaimet omalla koneellani:
```bash
# -C "" luo avaimeen tyhj√§n kommentin k√§ytt√§nimen ja koneen nimen sijaan
ssh-keygen -C ""
```

t√§m√§n j√§lkeen kopioin julkisen avaimen UpCloudin verkkosivujen lomakkeeseen.

```bash
$ cat .ssh/id_ed25519.pub
ssh-ed25519 AAAAC3NzaC...
```

Server name, sek√§ hostname valitsin "debian"

Painetaan Deploy ja odotetaan hetki.

Testataan, ett√§ p√§√§st√§√§n kirjautumaan palvelimelle:
```bash
ssh root@<palvelimen-ip>

$ root@debian:~# hostnamectl
 Static hostname: debian
       Icon name: computer-vm
         Chassis: vm üñ¥
      Machine ID: 0006a4...
         Boot ID: 6ebd93...
    Product UUID: 0006a...
  Virtualization: kvm
Operating System: Debian GNU/Linux 13 (trixie)        
          Kernel: Linux 6.12.38+deb13-amd64
    Architecture: x86-64
 Hardware Vendor: UpCloud
  Hardware Model: Cloud Server
Firmware Version: 1.16.2-debian-1.16.2-1
   Firmware Date: Tue 2014-04-01
    Firmware Age: 11y 5month 2w 
```

### b) Alkutoimet[^2]
Kaikki alla olevat komennot suoritetaan et√§palvelimella ellei toisin mainita. ja `<palvelimen-ip>` tulee korvata oman palvelimen IP-osoitteella.

Aloitetaan luomalla uusi k√§ytt√§j√§ ja lis√§√§m√§ll√§ se sudo ryhm√§√§n jolloin sill√§ voidaan suorittaa komentoja p√§√§k√§ytt√§j√§n oikeuksin
```bash
sudo adduser user
sudo usermod -aG sudo user
```

Testataan ett√§ uusi k√§ytt√§j√§ toimii odotetusti:
```bash
su - user
$ whoami
user
$ sudo whoami
root

# kaikki ok
```

Kopioidaan SSH avain uudelle k√§ytt√§j√§lle:
```bash
$ whoami
user # olemme luomallamme k√§ytt√§j√§ll√§

mkdir -p $HOME/.ssh

# poistetaan muilta kuin omistajalta oikeudet kansioon
chmod og-rwx $HOME/.ssh

# kopioidaan julkinen avain root k√§ytt√§j√§lt√§
sudo cp /root/.ssh/authorized_keys $HOME/.ssh/

# otetaan omistajuus kopioidulle tiedostolle
chown -R user:user $HOME/.ssh/authorized_keys
```

Kokeillaan viel√§ ett√§ uusi k√§ytt√§j√§ p√§√§see kirjautumaan SSH avaimella:
```bash
# omalla koneella
ssh user@<palvelimen-ip>

# ei virheit√§, kaikki ok
```

P√§ivitet√§√§n paketit ja asennetaan ufw palomuuri
```bash
sudo apt update -y && sudo apt upgrade -y
sudo apt install ufw -y
```

Sallitaan SSH liikenne ja otetaan palomuuri k√§ytt√∂√∂n
```bash
sudo ufw allow 22/tcp
sudo ufw enable

$ sudo ufw status
Status: active
```

Lukitaan root k√§ytt√§j√§ ja estet√§√§n root k√§ytt√§j√§n SSH kirjautuminen
```bash
sudo usermod --lock root
sudo sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config

# tarkistetaan
$ cat /etc/ssh/sshd_config | grep PermitRootLogin
PermitRootLogin no

# uudelleen k√§ynnistet√§√§n ssh daemon jotta muutokset tulevat voimaan
sudo systemctl restart sshd
```

Varmistetaan ett√§ root k√§ytt√§j√§ on lukittu
```bash
# omalla koneella
$ ssh root@<palvelimen-ip>
root@<palvelimen-ip>: Permission denied (publickey).

# kaikki ok
```

### c) & d) Web-palvelin[^3]
Kaikki alla olevat komennot suoritetaan et√§palvelimella ellei toisin mainita. ja `<palvelimen-ip>` tulee korvata oman palvelimen IP-osoitteella.

Asennetaan Apache web-palvelin
```bash
sudo apt install apache2 -y
```

Testataan ett√§ web-palvelin toimii
```bash
$ curl -sI 127.0.0.1 | head -n 1
HTTP/1.1 200 OK
```

Korvataan oletussivusto
```bash
mkdir -p $HOME/public_sites/basic/
echo '<!DOCTYPE html><html lang="en"><title>foo</title><p>bar</p>' > $HOME/public_sites/basic/index.html

# luodaan uusi conf tiedosto
sudoedit /etc/apache2/sites-available/basic.conf

$ cat /etc/apache2/sites-available/basic.conf
<VirtualHost *:80>
 ServerName <palvelimen-ip>
 DocumentRoot /home/user/public_sites/basic
 <Directory /home/user/public_sites/basic>
   Require all granted
 </Directory>
</VirtualHost>
```

Korjataan oikeudet:
```bash
sudo chmod o+x /home /home/user /home/user/public_sites /home/user/public_sites/basic/
sudo chmod o+r /home/user/public_sites/basic/index.html
```

Apachen konfiguraation aktivointi ja lataus uudelleen:
```bash
# laitetaan uusi sivusto k√§ytt√∂√∂n
sudo a2ensite basic.conf
# poistetaan oletussivusto k√§yt√∂st√§
sudo a2dissite 000-default.conf
# ladataan konfiguraatiotiedostot uudelleen jotta muutokset tulevat voimaan
sudo systemctl reload apache2
```

Testataan:
```bash
curl -s 127.0.0.1
<!DOCTYPE html><html lang="en"><title>foo</title><p>bar</p>
```

T√§ss√§ vaiheessa web-palvelin ei ole viel√§ julkisesti saatavilla, koska palomuuri est√§√§ kaiken sis√§√§n tulevan liikenteen paitsi edell√§ avaamassamme TCP 22 portissa. Sallitaan HTTP liikenne palomuurissa:
```bash
sudo ufw allow 80/tcp
```

Testataan uudestaan omalla koneella:
```bash
# omalla koneella
$ curl <palvelimen-ip>
<!DOCTYPE html><html lang="en"><title>foo</title><p>bar</
```

![selain](/assets/h4/selain.png)


## L√§hteet:
- Teht√§v√§nanto: https://terokarvinen.com/linux-palvelimet/#h4-maailma-kuulee
[^1]: Lehto, S. 2022. Teoriasta k√§yt√§nt√∂√∂n pilvipalvelimen avulla (h4) - Susanna Lehto. Luettavissa: https://susannalehto.fi/2022/teoriasta-kaytantoon-pilvipalvelimen-avulla-h4/. Luettu: 14.09.2025.
[^2]: Karvinen, T. 2017. First Steps on a New Virtual Private Server ‚Äì an Example on DigitalOcean and Ubuntu 16.04 LTS | Tero Karvinen. Luettavissa: https://terokarvinen.com/2017/first-steps-on-a-new-virtual-private-server-an-example-on-digitalocean/. Luettu 14.09.2025.
[^3]: 0x00A 2025. linux_palvelimet/h3.md at master ¬∑ 0x00A/linux_palvelimet. Luettavissa: [h3-raportti](h3.md). Luettu: 14.09.2025.